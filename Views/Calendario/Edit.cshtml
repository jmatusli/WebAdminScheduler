@model WebAdminScheduler.Models.CP_CRONTAB;
@{
    ViewData["Title"] = "Edit";
}
<head>
    <link rel="stylesheet" href="~/css/clockpicker.css" />
    <link rel="stylesheet" href="~/css/datatables.min.css" />
    <link rel="stylesheet" href="~/lib/Toast/dist/jquery.toast.min.css" />
    <link rel="stylesheet" href="~/lib/SweetAlert/dist/sweetalert2.min.css" />
    <script src="~/js/jquery-1.11.3.min.js"></script>
    <script src="~/js/pdfmake.min.js"></script>
    <script src="~/js/vfs_fonts.js"></script>
    <script src="~/js/datatables.min.js"></script>
    <script src="~/lib/SweetAlert/dist/sweetalert2.min.js"></script>
    <script src="~/lib/Toast/dist/jquery.toast.min.js"></script>
    <script src="~/js/clockpicker.js"></script>
</head>	

@using (Html.BeginForm("UpdateCrontab", "Calendario", FormMethod.Post))
{
    <body>
        <h1>Calendarios</h1>
        <div class="card">
            <div class="card-header">
                Editar
            </div>
            <div class="card-body">
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
            <span id="passwordHelpInline" class="form-text">
              Hora Inicio
            </span>
          </div>
          <div class="col-auto">
            <div class="col-sm-4">
                <input type="text" class="form-control clockpicker" 
                    data-placement="right" data-align="top" name="horaIni" id="horaIni" data-autoclose="true" readonly="">
            </div>
          </div>

          <div class="col-auto">
            <span id="passwordHelpInline" class="form-text">
              Hora Fin
            </span>
          </div>

          <div class="col-auto">
            <div class="col-sm-4">
                <input type="text" class="form-control clockpicker" 
                    data-placement="right" data-align="top" name="horaFin" id="horaFin" data-autoclose="true" readonly="">
            </div>
          </div>
       
        </div><hr />
            
            <h4>Meses</h4>
            <div class="row g-4 align-items-center">
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input" id="flexCheckUptAllmonths" type="checkbox"/> Seleccionar/Deseleccionar todos<br><br>
                    </div>
                </div>
            </div>

            <div class="row g-4 align-items-center">
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckMes" type="checkbox" value="1" id="flexCheckUptEnero">
                        <label class="form-check-label" for="flexCheckTxtEnero">
                            Enero
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="2" id="flexCheckUptFebrero">
                        <label class="form-check-label" for="flexCheckTxtFebrero">
                            Febrero
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="3" id="flexCheckUptMarzo">
                        <label class="form-check-label" for="flexCheckTxtMarzo">
                            Marzo
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="4" id="flexCheckUptAbril">
                        <label class="form-check-label" for="flexCheckTxtAbril">
                            Abril
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="5" id="flexCheckUptMayo">
                        <label class="form-check-label" for="flexCheckTxtMayo">
                            Mayo
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="6" id="flexCheckUptJunio">
                        <label class="form-check-label" for="flexCheckTxtJunio">
                            Junio
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="7" id="flexCheckUptJulio">
                        <label class="form-check-label" for="flexCheckTxtJulio">
                            Julio
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="8" id="flexCheckUptAgost">
                        <label class="form-check-label" for="flexCheckTxtAgost">
                            Agosto
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="9" id="flexCheckUptSept">
                        <label class="form-check-label" for="flexCheckTxtSept">
                            Septiembre
                        </label>
                    </div>
                </div>        
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="10" id="flexCheckUptOct">
                        <label class="form-check-label" for="flexCheckTxtOct">
                            Octubre
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="11" id="flexCheckUptNov">
                        <label class="form-check-label" for="flexCheckTxtNov">
                            Noviembre
                        </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input flexCheckMes" type="checkbox" value="12" id="flexCheckUptDic">
                        <label class="form-check-label" for="flexCheckTxtDic">
                            Diciembre
                        </label>
                    </div>
                </div>
            </div>
            <hr />
                
            <h4>DÃ­as</h4>
            <div class="row g-4 align-items-center">
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input" id="flexCheckUptAlldays" type="checkbox" /> Seleccionar/Deseleccionar todos<br><br>
                    </div>
                </div>
            </div>

            <div class="row g-4 align-items-center">
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptLunes" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptLunes">
                        Lunes
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptMartes" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptMartes">
                        Martes
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptMiercoles" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptMiercoles">
                        Miercoles
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptJueves" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptJueves">
                        Jueves
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptViernes" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptViernes">
                        Viernes
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptSabado" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptSabado">
                        Sabado
                    </label>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="form-check">
                    <input class="form-check-input flexCheckDias" type="checkbox" value="" id="flexCheckUptDomingo" name="dias_semana">
                    <label class="form-check-label" for="flexCheckUptDomingo">
                        Domingo
                    </label>
                    </div>
                </div>
            </div>
            <hr />

            <h4>DÃ­as EjecuciÃ³n</h4>
            <div class="row g-4 align-items-center">
                <div class="col-auto">
                    <div class="form-check">
                        <input class="form-check-input" id="flexCheckUptAlldaysex" type="checkbox" /> Seleccionar/Deseleccionar todos<br><br>
                    </div>
                </div>
            </div>
            
            <table id="tbl-dias-exe" class="display nowrap" width="100%">
            <thead>
            <tr>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="1" id="flexCheckUptUnoExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtUnoExe">
                        1
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="2" id="flexCheckUptDosExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtDosExe">
                        2
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="3" id="flexCheckUptTresExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtTresExe">
                        3
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="4" id="flexCheckUptCuatroExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtCuatroExe">
                        4
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="5" id="flexCheckUptCincoExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtCincoExe">
                        5
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="6" id="flexCheckUptSeisExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtSeisExe">
                        6
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="7" id="flexCheckUptSieteExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtSieteExe">
                        7
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="8" id="flexCheckUptOchoExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtOchoExe">
                        8
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="9" id="flexCheckUptnueveExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtnueveExe">
                        9
                    </label>
                </td>
                <td>
                    <input class="form-check-input diasexe" type="checkbox" value="10" id="flexCheckUptDiezExe" name="dinamico" >
                </td>
                <td>
                    <label class="form-check-label" for="flexCheckTxtDiezExe">
                        10
                    </label>
                </td>
            </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="11" id="flexCheckUptOnceExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtOnceExe">
                            11
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="12" id="flexCheckUptDoceExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtDoceExe">
                            12
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="13" id="flexCheckUptTreceExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtTreceExe">
                            13
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="14" id="flexCheckUptCatorceExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtCatorceExe">
                            14
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="15" id="flexCheckUptQuinceExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtQuinceExe">
                            15
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="16" id="flexCheckUptDiesiseisExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtDiesiseisExe">
                            16
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="17" id="flexCheckUptDiesicieteExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtDiesicieteExe">
                            17
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="18" id="flexCheckUptDiesiochoExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtDiesiochoExe">
                            18
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="19" id="flexCheckUptDiecinueveExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtDiecinueveExe">
                            19
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="20" id="flexCheckUptVeinteExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeinteExe">
                            20
                        </label>
                    </td>
                </tr>
            </tbody>
            </table>
            <table id="tbl-dias-exe" class="display nowrap" width="100%">
                <thead>
                <tr>
                    <th>
                        <input class="form-check-input diasexe" type="checkbox" value="21" id="flexCheckVeintiunoExe" name="dinamico" >
                    </th>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintiunoExe">
                            21
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="22" id="flexCheckUptVeintidosExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintidosExe">
                            22
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="23" id="flexCheckUptVeintitresExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintitresExe">
                            23
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="24" id="flexCheckUptVeinticuatroExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeinticuatroExe">
                            24
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="25" id="flexCheckUptVeinticincoExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeinticincoExe">
                            25
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="26" id="flexCheckUptVeintiseisExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintiseisExe">
                            26
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="27" id="flexCheckUptVeintisieteExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintisieteExe">
                            27
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="28" id="flexCheckUptVeintiochoExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintiochoExe">
                            28
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="29" id="flexCheckUptVeintinueveExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtVeintinueveExe">
                            29
                        </label>
                    </td>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="30" id="flexCheckUptTreintaExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtTreintaExe">
                            30
                        </label>
                    </td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        <input class="form-check-input diasexe" type="checkbox" value="31" id="flexCheckUptTreintaunoExe" name="dinamico" >
                    </td>
                    <td>
                        <label class="form-check-label" for="flexCheckTxtTreintaunoExe">
                            31
                        </label>
                    </td>
                </tr>
                </tbody>
            </table>
            <hr />

            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
                        <span id="txtRepeatEveryMins" class="form-text">
                            REPEAT_EVERY_MINS
                        </span>
                    </div>
                    <div class="col-auto">
                        <input type="number" min="1" id="UptRepeatEveryMins" class="form-control" data-placement="right" data-align="top" data-autoclose="true">
                        
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="IdUptRepeatAfterFin">
                            <label class="form-check-label" for="RepeatAfterFin">
                                REPEAT_AFTER_FINISH
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer text-muted">
            <a id="btnSave" onclick="Guardar()" class="btn btn-primary">Guardar</a>
        </div>
    </div>
    </body>
}

<script> 
    var params={};
    var table={};
    var idcrontab="@ViewBag.IDCRONTAB";

    var vhorainitmp="@Model.HORA_INICIO";
    var vhorafintmp="@Model.HORA_FIN";
    var idRepAftFin="@Model.REPEAT_AFTER_FINISH";
    var diasSel="@Model.WDAY_M2S_EX";

    var vdiasexe="@Model.DAY_EX";  //aqui puede venir un valor en 0 o una cadena separada por ,
    var vmonthexe="@Model.MONTH_EX";//aqui puede venir un valor en 0 o una cadena separada por ,


    var hora_ini=vhorainitmp[0]+""+vhorainitmp[1]+":"+vhorainitmp[2]+""+vhorainitmp[3];
    var hora_fin=vhorafintmp[0]+""+vhorafintmp[1]+":"+vhorafintmp[2]+""+vhorafintmp[3];
 
    var diasex="0";
    var monthex="0";

    var mesesArray=[];
    var diasexeArray=[];
 

   function daysMonth(anio,mes){
var arrayDays=[];
var diasMes = new Date(anio, mes, 0).getDate();
var diasSemana = ['Domingo', 'Lunes', 'Martes', 'MiÃ©rcoles', 'Jueves', 'Viernes', 'SÃ¡bado'];

for (var dia = 1; dia <= diasMes; dia++) {
  // Ojo, hay que restarle 1 para obtener el mes correcto
  var indice = new Date(anio, mes - 1, dia).getDay();
    arrayDays.push({"dia":`${dia}`,"mes":`${mes}`,"anio":`${anio}`,"nombredia":`${diasSemana[indice]}`});
}
return arrayDays;
}

function getDays(arrayDay,dia){
 var data=$.map(arrayDay, function(obj) {
    if(obj.nombredia == dia || dia=="")
         return obj; 
});
    return data;

    
}


    params.idcrontab=idcrontab;
    var conteodia=0;
    if(diasSel[0]==1){
        $("#flexCheckUptLunes").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptLunes").prop('checked', false);
    }
    
    if(diasSel[1]==1){
        $("#flexCheckUptMartes").prop('checked', true);
         conteodia +=1;
    } else {
        $("#flexCheckUptMartes").prop('checked', false);
    }
 
    if(diasSel[2]==1){
        $("#flexCheckUptMiercoles").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptMiercoles").prop('checked', false);
    } 
  
    if(diasSel[3]==1){
        $("#flexCheckUptJueves").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptJueves").prop('checked', false);
    } 

    if(diasSel[4]==1){
        $("#flexCheckUptViernes").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptViernes").prop('checked', false);
    } 

    if(diasSel[5]==1){
        $("#flexCheckUptSabado").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptSabado").prop('checked', false);
    } 

    if(diasSel[6]==1){
        $("#flexCheckUptDomingo").prop('checked', true);
        conteodia +=1;
    } else {
        $("#flexCheckUptDomingo").prop('checked', false);
    } 
   
    if(conteodia==7)
     $("#flexCheckUptAlldays").prop('checked', true);
     else 
     $("#flexCheckUptAlldays").prop('checked', false);
    if (idRepAftFin == 1) {
        $("#IdUptRepeatAfterFin").prop('checked', true);
    } else {
        $("#IdUptRepeatAfterFin").prop('checked', false);
    }
 
    var repeat_every_mins = "@Model.REPEAT_EVERY_MINS";
 
   


    $(document).on("ready",function() {
        $('.clockpicker').clockpicker();
        $("#horaIni").val(hora_ini);
        $("#horaFin").val(hora_fin);
        $("#UptRepeatEveryMins").val(repeat_every_mins);

       if(vmonthexe=="0")
       {
         $(".flexCheckMes").prop("checked",true);
         
          $("#flexCheckUptAllmonths").prop("checked",true);
       }
       else 
       {
        let Arraymexe = vmonthexe.split(","); //obtenemos meses de ejecucion separados por ,
         $(Arraymexe).each(function(index, item){
        console.log("mes ejecucion ",index," ",item);

        $(".flexCheckMes:checkbox[value="+item+"]").prop("checked","true").trigger("change");
       
         });
       
       }


       if(vdiasexe=="0")
       {
          $(".diasexe").prop("checked",true);

          $("#flexCheckUptAlldaysex").prop("checked",true);

          
       }
       else 
       {
         let Arraydexe = vdiasexe.split(","); //obtenemos dias de ejecucion separados por ,
           $(Arraydexe).each(function(index, item){
         $(".diasexe:checkbox[value="+item+"]").prop("checked","true").trigger("change");
        
         });
       }
    
      $(".flexCheckMes").on("change",function(){

    if($(this).is(":checked"))
    { 
      var miarrayx=daysMonth(2024,$(this).val());
      var dias=getDays(miarrayx,"");
      if($('.flexCheckMes:checked').length==1)
      $(".diasexe").prop("disabled",true);
      $.each(dias, function( index, item ) 
      {
        //console.log(item);
        $(":checkbox[value="+item.dia+"]").prop("disabled",false);
      });
      //  console.log("mes seleccionado ",$(this).is(":checked")," valor ",$(this).val())
      mesesArray.indexOf($(this).val()) === -1 ? mesesArray.push($(this).val()) :''; 
    } 
    else 
    {
      const index = mesesArray.indexOf($(this).val());
      const x = mesesArray.splice(index, 1);
    }
    console.log("meses seleccionados ",mesesArray.join(","));
    })
  
    $(".flexCheckDias").on("change",function(){
    /*if($(this).is(":checked"))
    console.log("dia seleccionado ",$(this).is(":checked")," valor ",$(this).val())
    */
    var miarrayx=daysMonth(2024,$('.flexCheckMes:checked').val());
    var dias=getDays(miarrayx,$(this).val());
    if($('.flexCheckDias:checked').length==1) {
      $(".diasexe").prop("disabled",true);
      $.each(dias, function( index, item ) {
        //console.log(item);
        $(":checkbox[value="+item.dia+"]").prop("disabled",false);
      });
    }
    else 
      $(".diasexe").prop("disabled",false);
    })

  $(".diasexe").on("change",function() {
    if($(this).is(":checked"))
    {
      diasexeArray.indexOf($(this).val()) === -1 ? diasexeArray.push($(this).val()) : '';
    }
    else 
    {
      const index = diasexeArray.indexOf($(this).val());
      const x = diasexeArray.splice(index, 1);
    }
    console.log("dias ejecucion  seleccionados ",diasexeArray.join(","));
  })



        
    $("#flexCheckUptAllmonths").on("change",function(){
    if($(this).is(":checked"))
          $(".flexCheckMes").prop("checked",true);
          else
          $(".flexCheckMes").prop("checked",false);

    });
    
    $("#flexCheckUptAlldays").on("change",function(){
     if($(this).is(":checked"))
          $(".flexCheckDias").prop("checked",true);
          else
          $(".flexCheckDias").prop("checked",false);

    });
    
    $("#flexCheckUptAlldaysex").on("change",function(){
    if($(this).is(":checked"))
         $(".diasexe").prop("checked",true);
          else
          $(".diasexe").prop("checked",false);

    });
    })

    function Guardar() {
        hora_ini=$('#horaIni').val();
        hora_ini=hora_ini.replace(":", "");

        hora_fin=$('#horaFin').val();
        hora_fin=hora_fin.replace(":", "");

        repeat_every_mins=$('#UptRepeatEveryMins').val();

        var diastext=($('#flexCheckUptLunes').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptMartes').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptMiercoles').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptJueves').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptViernes').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptSabado').is(":checked") ? 1 : 0) + ""
            +($('#flexCheckUptDomingo').is(":checked") ? 1 : 0) + "";

           
       

        if($("#flexCheckUptAlldaysex").is(":checked") )
        diasex="0";  
        else 
        diasex=diasexeArray.length > 0 ? diasexeArray.join(","):"0"; 

       if($("#flexCheckUptAllmonths").is(":checked"))
        monthex="0"; 
       else 
       monthex=mesesArray.length > 0 ? mesesArray.join(","):"0"; 
      
       



        var data_cron={
            "oCrontab": {
            "IDCRONTAB": idcrontab,
            "FECHA":"00000000",
            "HORA_INICIO":hora_ini,
            "HORA_FIN":hora_fin,
            "RECURRENCIA":"0000",
            "WDAY_M2S_EX":diastext,
            "DAY_EX":diasex,
            "MONTH_EX":monthex,
            "REPEAT_EVERY_MINS":repeat_every_mins,
            "REPEAT_AFTER_FINISH":$('#IdUptRepeatAfterFin').is(":checked") ? 1 : 0
        }
    };

    if (idcrontab != 0) {
        jQuery.ajax({
        method: "POST",
        async: true,
        dataType: "json",
        data: JSON.stringify(data_cron),
        contentType: "application/json; charset=utf-8",
        url: "@Url.Action("Update","Calendario")",

        success: function (data) {
            Swal.fire({
            title: "Calendario Actualizado!",
            text: "Click en aceptar para ver calendarios!",
            icon: "success",
            confirmButtonText: "Aceptar",
        }).then((result) => {
        if (result.isConfirmed) {
            $(location).attr("href","@Url.Action("Index","Calendario")")
        }  
    });
}
});
} else {
    $("#horaIni").val("");
    $("#horaFin").val("");
    $("#UptRepeatEveryMins").val("");
}
}
</script>