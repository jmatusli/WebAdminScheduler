@model WebAdminScheduler.Models.CP_CRONTAB;
@{
    ViewData["Title"] = "Detalle";
}
<head>
    <link rel="stylesheet" href="~/css/datatables.min.css" />
    <link rel="stylesheet" href="~/lib/Toast/dist/jquery.toast.min.css" />
    <link rel="stylesheet" href="~/lib/SweetAlert/dist/sweetalert2.min.css" />
    <script src="~/js/jquery-1.11.3.min.js"></script>
    <script src="~/js/pdfmake.min.js"></script>
    <script src="~/js/vfs_fonts.js"></script>
    <script src="~/js/datatables.min.js"></script>
    <script src="~/lib/SweetAlert/dist/sweetalert2.min.js"></script>
    <script src="~/lib/Toast/dist/jquery.toast.min.js"></script>
</head>	

    <body>
        <h1>Calendarios</h1>
        <div class="card">
            <div class="card-header">
                Detalle
            </div>
            <div class="card-body">
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
                        <label for="TittleCrontab" class="col-form-label">IDCRONTAB</label>
                    </div>
                    <div class="col-auto">
                        <label for="txtCrontab" class="col-form-label" id="txtCrontab">@Model.IDCRONTAB</label>
                    </div>
                    <div class="col-auto">
                        <span id="passwordHelpInline" class="form-text">
                            Hora Inicio
                        </span>
                    </div>
                    <div class="col-auto">
                        <label for="txtHoraIni" class="col-form-label" id="txtHoraIni">@Model.HORA_INICIO</label>
                    </div>
                    <div class="col-auto">
                        <span id="passwordHelpInline" class="form-text">
                            Hora Fin
                        </span>
                    </div>
                    <div class="col-auto">
                        <label for="txtHoraFin" class="col-form-label" id="txtHoraFin">@Model.HORA_FIN</label>
                    </div>
                </div><hr />

                <h4>Días</h4>
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckLunes">
                            <label class="form-check-label" for="flexCheckLunes">
                                Lunes
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckMartes">
                            <label class="form-check-label" for="flexCheckMartes">
                                Martes
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckMiercoles">
                            <label class="form-check-label" for="flexCheckMiercoles">
                                Miercoles
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckJueves">
                            <label class="form-check-label" for="flexCheckJueves">
                                Jueves
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckViernes">
                            <label class="form-check-label" for="flexCheckViernes">
                                Viernes
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckSabado">
                            <label class="form-check-label" for="flexCheckSabado">
                                Sabado
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckDomingo">
                            <label class="form-check-label" for="flexCheckDomingo">
                                Domingo
                            </label>
                        </div>
                    </div>
                </div>
                <hr />

                <h4>Días Ejecución</h4>
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" onClick="toggle(this)" /> Seleccionar/Deseleccionar todos<br><br>
                        </div>
                    </div>
                </div>
                
                <table id="tbl-dias-exe" class="display nowrap" width="100%">
                    <thead>
                    <tr>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptUnoExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtUnoExe">
                                1
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDosExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtDosExe">
                                2
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptTresExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtTresExe">
                                3
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptCuatroExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtCuatroExe">
                                4
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptCincoExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtCincoExe">
                                5
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptSeisExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtSeisExe">
                                6
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptSieteExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtSieteExe">
                                7
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptOchoExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtOchoExe">
                                8
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptnueveExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtnueveExe">
                                9
                            </label>
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDiezExe" name="dinamico" >
                        </td>
                        <td>
                            <label class="form-check-label" for="flexCheckTxtDiezExe">
                                10
                            </label>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptOnceExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtOnceExe">
                                    11
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDoceExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtDoceExe">
                                    12
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptTreceExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtTreceExe">
                                    13
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptCatorceExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtCatorceExe">
                                    14
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptQuinceExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtQuinceExe">
                                    15
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDiesiseisExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtDiesiseisExe">
                                    16
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDiesicieteExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtDiesicieteExe">
                                    17
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDiesiochoExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtDiesiochoExe">
                                    18
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDiecinueveExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtDiecinueveExe">
                                    19
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeinteExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeinteExe">
                                    20
                                </label>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table id="tbl-dias-exe" class="display nowrap" width="100%">
                    <thead>
                        <tr>
                            <th>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckVeintiunoExe" name="dinamico" >
                            </th>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintiunoExe">
                                    21
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintidosExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintidosExe">
                                    22
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintitresExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintitresExe">
                                    23
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeinticuatroExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeinticuatroExe">
                                    24
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeinticincoExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeinticincoExe">
                                    25
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintiseisExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintiseisExe">
                                    26
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintisieteExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintisieteExe">
                                    27
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintiochoExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintiochoExe">
                                    28
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptVeintinueveExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtVeintinueveExe">
                                    29
                                </label>
                            </td>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptTreintaExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtTreintaExe">
                                    30
                                </label>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input class="form-check-input" type="checkbox" value="" id="flexCheckUptTreintaunoExe" name="dinamico" >
                            </td>
                            <td>
                                <label class="form-check-label" for="flexCheckTxtTreintaunoExe">
                                    31
                                </label>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <hr />

                <h4>Meses</h4>
                <div class="row g-4 align-items-center">
                    <div class="col-auto">
                        <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="flexCheckUptEnero">
                            <label class="form-check-label" for="flexCheckTxtEnero">
                                Enero
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptFebrero">
                            <label class="form-check-label" for="flexCheckTxtFebrero">
                                Febrero
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptMarzo">
                            <label class="form-check-label" for="flexCheckTxtMarzo">
                                Marzo
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptAbril">
                            <label class="form-check-label" for="flexCheckTxtAbril">
                                Abril
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptMayo">
                            <label class="form-check-label" for="flexCheckTxtMayo">
                                Mayo
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptJunio">
                            <label class="form-check-label" for="flexCheckTxtJunio">
                                Junio
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptJulio">
                            <label class="form-check-label" for="flexCheckTxtJulio">
                                Julio
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptAgost">
                            <label class="form-check-label" for="flexCheckTxtAgost">
                                Agosto
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptSept">
                            <label class="form-check-label" for="flexCheckTxtSept">
                                Septiembre
                            </label>
                        </div>
                    </div>        
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptOct">
                            <label class="form-check-label" for="flexCheckTxtOct">
                                Octubre
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptNov">
                            <label class="form-check-label" for="flexCheckTxtNov">
                                Noviembre
                            </label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="flexCheckUptDic">
                            <label class="form-check-label" for="flexCheckTxtDic">
                                Diciembre
                            </label>
                        </div>
                    </div>
                </div>
                
                <hr />
                <div class="accordion accordion-flush" id="accordionFlushExample">
                    <div class="row g-4 align-items-center">
                        <div class="col-auto">
                            <span id="txtRepeatEveryMins" class="form-text">
                                REPEAT_EVERY_MINS
                            </span>
                        </div>
                        <div class="col-auto">
                            <label for="RepeatEveryMins" class="col-form-label" id="RepeatEveryMins">@Model.REPEAT_EVERY_MINS</label>
                        </div>
                        <div class="col-auto">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="TxtIdRepeatAfterFin" disabled>
                                <label class="form-check-label" for="RepeatAfterFin">
                                    REPEAT_AFTER_FINISH
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer text-muted">
            </div>
        </div>

        <div class="container">
            <table id="dt-jobs" class="display nowrap" width="100%">
                <thead>
                <tr>
                    <th><input type="checkbox" name="select_all" class="dt-column-title" value="1" id="tblJobs-select-all"></th>
                    <th>IDPROC</th>
                    <th>IDCONEX</th>
                    <th>NOMBRE</th>
                    <th>DESCRIPCIÓN</th>
                    <th>PATH</th>  
                    <th>PARAMETRO1</th>
                    <th>PARAMETRO2</th>
                    <th>PARAMETRO3</th>
                    <th>PARAMETRO4</th>
                    <th>DEPENDENCIA</th>
                    <th>INTENTOS</th>
                    <th>ESPERA INTENTO</th>
                    <th>ESTADO</th>
                    <th>FTP</th>
                    <th>IDHOST</th>
                    <th>COMPRESIÓN</th>
                    <th>IDCRONTAB</th>
                    <th>NODE</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </body>
    
<script> 
    var params={};
    var table={};
    var idcrontab="@ViewBag.IDCRONTAB";
    var idRepAftFin="@Model.REPEAT_AFTER_FINISH";
    params.idcrontab=idcrontab;

    console.log(idRepAftFin,'idRepAftFin');
    if (idRepAftFin = 1) {
        $("#TxtIdRepeatAfterFin").prop('checked', true);
    } else {
        $("#TxtIdRepeatAfterFin").prop('checked', false);
    }

    function toggle(source) {
      checkboxes = document.getElementsByName('dinamico');

        for(var i=0, n=checkboxes.length;i<n;i++) {
            checkboxes[i].checked = source.checked;
        }
    }

    $(document).on("ready",function() {

        table = $('#dt-jobs').DataTable( {
            "processing": true,
            "serverSide": true,
            "filter": true,
            "scrollX":          true,
            "sScrollX":         "50%",
            "scrollY":            $(document).height() - 300,
            "scrollCollapse":     true,
            "ajax": {
                "url": "@Url.Action("ListarJobsAsoc","Calendario")",
                "type": "GET",
                "datatype": "json",
                "data": function(d){
                $.extend( d, params);    
                },
        },drawCallback: function(settings){ 
			  if($(this).find('tbody tr').length <= 1){
			  $('.dt-paging-button').hide();
			}
		},
            "columnDefs": [{
            'targets': 0,
            orderable: false,
            'render': function (data, type, full, meta){
                return '<input type="checkbox" name="id[]" value="' + $('<div/>').text(data).html() + '">';
            }
            }],
            "columns": [
            {
                "render": function (data,row) { return '<input type="checkbox" name="select_all" class="dt-column-title" value="1" id="example-select-all-item">';   }
            },
                { "data": "idproc", "name": "idproc", "autoWidth": true },
                { "data": "idconex", "name": "idconex", "autoWidth": true },
                { "data": "nombre", "name": "nombre", "autoWidth": true },
                { "data": "descripcion", "name": "descripcion", "autoWidth": true },
                { "data": "path", "name": "path", "autoWidth": true },
                { "data": "parametrO1", "name": "parametrO1", "autoWidth": true },
                { "data": "parametrO2", "name": "parametrO2", "autoWidth": true },
                { "data": "parametrO3", "name": "parametrO3", "autoWidth": true },
                { "data": "parametrO4", "name": "parametrO4", "autoWidth": true },
                { "data": "dependencia", "name": "dependencia", "autoWidth": true },
                { "data": "intentos", "name": "intentos", "autoWidth": true },
                { "data": "esperA_INTENTO", "name": "esperA_INTENTO", "autoWidth": true },
                { "data": "estado", "name": "estado", "autoWidth": true },
                { "data": "ftp", "name": "ftp", "autoWidth": true },
                { "data": "idhost", "name": "idhost", "autoWidth": true },
                { "data": "compresion", "name": "compresion", "autoWidth": true },
                { "data": "idcrontab", "name": "idcrontab", "autoWidth": true },
                { "data": "node", "name": "node", "autoWidth": true },
            ],
            
            select: {
            style:    'single',   //default but you have to specify it, no idea why
            selector: 'tr,a:not(.btn)'
            },
            "language": {
            "url": "/lib/datatables/dist/locales/es/es.json"
            }
        });
 
        table.on('select', function (e, dt, type, indexes) {
        console.log(e.target);
        if (type === 'row'   ) {
            var nodes = table
            .rows(indexes)
            .nodes()
            .each(function () { 
            $('td:first-child', this).find('input').prop('checked', true); 
            });
        }
        });

        table.on('deselect', function (e, dt, type, indexes) {
        if (type === 'row') {
        $('#tblJobs-select-all').prop("checked",false);
            table
            .rows(indexes)
            .nodes()
            .each(function () { 
            $('td:first-child', this).find('input').prop('checked', false); 
            });
        }
        });
        
        // Handle click on "Select all" control
        $('#tblJobs-select-all').on('click', function(){
            
       if(table.settings()[0]._select.style=='multi')
        { 
        // Get all rows with search applied
            var rows = table.rows({ 'search': 'applied' }).nodes();
            // Check/uncheck checkboxes for all rows in the table
        if(this.checked){
            $('input[type="checkbox"]', rows).prop('checked', this.checked);
            
            var selData =   table.rows().select();
            var selData =   table.rows(".selected").data();
        }
        else 
        {
            var selData =   table.rows().deselect();
        }
        }
        else 
        return false;
        });

        // Handle click on checkbox to set state of "Select all" control
        $('#dt-jobs tbody').on('change', 'input[type="checkbox"]', function(){
        // If checkbox is not checked
        if(!this.checked){
          var el = $('#tblJobs-select-all').get(0);
          // If "Select all" control is checked and has 'indeterminate' property
          if(el && el.checked && ('indeterminate' in el)){
          // Set visual state of "Select all" control
          // as 'indeterminate'
          el.indeterminate = true;
        }
      }
    });
   // recargartabla(table,idcrontab);
    })
      
</script>